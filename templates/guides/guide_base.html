{% extends "base.html" %}

{# Base template for all guide pages - provides consistent structure and SEO #}
{# Scroll Animations: Add 'animation-ready fade-in' to sections for smooth scroll animations #}
{# Animation classes: fade-in (slide up), fade-in-left (slide from left) #}
{# Animations respect prefers-reduced-motion for accessibility #}

{# Remove default padding-top from main element so hero sits flush against site banner #}
{% block main_class %}{% endblock %}

{% block head %}
  <meta name="description" content="{% block meta_desc %}{% endblock %}">
  
  {# FAQ Schema - child templates can override mainEntity #}
  {% block faq_schema %}
  <script type="application/ld+json" nonce="{{ g.csp_nonce|default('') }}">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": {% block faq_items %}[]{% endblock %}
  }
  </script>
  {% endblock %}

  {# Breadcrumb Schema - uses same title as main heading #}
  {% set page_title = self.guide_title() %}
  <script type="application/ld+json" nonce="{{ g.csp_nonce|default('') }}">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem", "position": 1,
      "name": "Guides", "item": "{{ request.url_root.rstrip('/') }}/guides"
    },{
      "@type": "ListItem", "position": 2,
      "name": "{{ page_title }}",
      "item": "{{ request.url }}"
    }]
  }
  </script>
{% endblock %}

{% block content %}
{# Hero-Style Guide Header - Full width outside container #}
<div class="hero--guide">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-9">
        <div class="hero--guide__inner">
          <header class="guide__header animation-ready fade-in">
            <h1 class="guide__title">{% block guide_title %}{% endblock %}</h1>
            <p class="guide__subtitle">
              {% block guide_subtitle %}{% endblock %}
            </p>
          </header>
          
          {# Primary CTA Button #}
          <div class="hero--guide__cta">
            <a href="{% block hero_cta_link %}/{% endblock %}" class="btn btn-primary">
              {% block hero_cta_text %}Compare Firms{% endblock %}
            </a>
          </div>
          
          {# Trust Element - Optional, override in child templates #}
          {% block hero_trust %}
          {# Default: no trust element. Child templates can add their own. #}
          {% endblock %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Guide Hero Divider -->
<div class="guide-hero__divider"></div>

<section class="container guide pt-4 pt-md-5 pb-0">
  <div class="row justify-content-center">
    <article class="col-12 col-lg-9 prose">
      
      {# Top Back Link #}
      {% if guide_back.href %}
      <nav class="guide__back-nav mb-3 animation-ready fade-in">
        <a href="{{ guide_back.href }}" class="guide__back-link guide-back__link text-decoration-none" data-back-type="context">
          {{ guide_back.label }}
        </a>
      </nav>
      {% endif %}

      {# Main Content Sections #}
      {% block guide_content %}
        {# Child templates define their content sections here #}
      {% endblock %}

      {# CTA Section - can be overridden or hidden #}
      {% block guide_cta %}
      <div class="guide__section animation-ready fade-in">
        <div class="guide__cta">
          <div class="d-flex flex-column flex-md-row align-items-md-center gap-3">
            <div class="flex-grow-1">
              <h3 class="guide__cta__title">{% block cta_title %}Ready to Start?{% endblock %}</h3>
              <p class="guide__cta__text">{% block cta_text %}Compare top firms, pick your path, and start trading.{% endblock %}</p>
            </div>
            <div class="d-flex flex-column flex-sm-row gap-3 flex-shrink-0">
              <a href="{% block cta_link %}/compare{% endblock %}" class="btn btn-primary">
                {% block cta_button %}Start Trading{% endblock %}
              </a>
              <a href="{% block cta_secondary_link %}/{% endblock %}" class="btn btn-secondary">
                {% block cta_secondary_button %}Compare Firms{% endblock %}
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endblock %}

      {# Bottom Back Link - Always goes to Guides index #}
      <nav class="guide__back-nav-bottom mt-4 mb-4 animation-ready fade-in">
        <a href="{{ url_for('guides_index') }}" class="guide__back-link guide-back__link text-decoration-none" data-back-type="index">
          ‚Üê Back to Guides
        </a>
      </nav>

      {# Divider before FAQ Section #}
      <div class="guide-content__divider"></div>

      {# FAQ Section #}
      {% block guide_faq %}
      <div class="guide__faq-section animation-ready fade-in">
        <h2 class="guide__section-title">Common questions</h2>
        {% block faq_content %}
          {# Child templates define FAQ items here #}
        {% endblock %}
      </div>
      {% endblock %}

      {# Divider before Keep Learning Section #}
      <div class="guide-content__divider"></div>

      {# Keep Learning Section #}
      {% block guide_next %}
      <nav class="guide__next animation-ready fade-in" aria-label="Related guide links">
        <h2 class="guide__next__title">Keep learning</h2>
        <ul class="guide__next__list">
          {% block next_links %}
            {# Child templates define related links here #}
          {% endblock %}
        </ul>
      </nav>
      {% endblock %}

      {# Divider before Disclosure #}
      <div class="guide-content__divider"></div>

      {# Disclosure #}
      {% block guide_disclosure %}
      <p class="guide__disclosure">
        {% block disclosure_text %}
          Disclosure: Prop Tools partners with select firms. We may earn a commission when you use our links. 
          We review rules and costs independently to keep recommendations objective.
        {% endblock %}
      </p>
      {% endblock %}

      {# Last Updated Date - Only show on individual guide pages, not index #}
      {% if guide_updated %}
      <p class="guide__updated">
        Last updated: {{ guide_updated }}
      </p>
      {% endif %}

    </article>
  </div>
</section>
{% endblock %}