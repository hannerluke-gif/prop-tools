// ============================================================
// HERO-STYLE HEADER (GUIDE VARIANT)
// Full-width hero with left-aligned content, CTA, and trust element
// Placed outside .guide class since hero is outside container in HTML
// ============================================================
.hero--guide {
  position: relative;
  overflow: hidden;
  min-height: $guide-hero-min-height;
  padding: $guide-hero-padding-mobile;
  margin-top: 0; // Remove any top margin to sit flush against site banner
  margin-bottom: 0; // No margin - divider handles spacing
  
  // Vignette overlay, grid pattern with gradient accents
  background: 
    linear-gradient(180deg, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.85) 88%),
    linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
    radial-gradient(1200px 600px at 15% -10%, rgba(139, 92, 246, 0.25), transparent 60%),
    radial-gradient(900px 500px at 85% 0%, rgba(34, 211, 238, 0.22), transparent 60%),
    $guide-hero-bg-base;
  
  background-size: 100% 100%, 40px 40px, 40px 40px, 100% 100%, 100% 100%, 100% 100%;
  background-position: center center;
  background-repeat: no-repeat, repeat, repeat, no-repeat, no-repeat, no-repeat;
  
  // Desktop sizing
  @media (min-width: 768px) {
    padding: $guide-hero-padding-desktop;
  }
  
  // Inner content wrapper - now uses Bootstrap grid for perfect alignment with content below
  &__inner {
    position: relative;
    z-index: 2;
    text-align: left; // Left-aligned content
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-height: inherit;
  }
  
  // CTA button styling - uses global button variables
  &__cta {
    margin-top: 1.5rem;
    // No custom button styles - inherits from global $btn-* variables
  }
  
  // Trust element styling
  &__trust {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    
    .star-icon {
      color: #fbbf24; // Gold color for star
      font-size: 1.1rem;
    }
  }
  
  // Animated accent shapes (decorative elements)
  &::before,
  &::after {
    content: '';
    position: absolute;
    border-radius: 50%;
    opacity: 0.4;
    filter: blur(80px);
    animation: guide-hero-float 20s ease-in-out infinite;
  }
  
  &::before {
    top: -10%;
    left: -5%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(139, 92, 246, 0.6), transparent 70%);
    animation-delay: 0s;
    
    @media (min-width: 768px) {
      width: 450px;
      height: 450px;
    }
  }
  
  &::after {
    bottom: -15%;
    right: -5%;
    width: 350px;
    height: 350px;
    background: radial-gradient(circle, rgba(34, 211, 238, 0.5), transparent 70%);
    animation-delay: 7s;
    
    @media (min-width: 768px) {
      width: 500px;
      height: 500px;
    }
  }
}

// ============================================================
// GUIDE HERO DIVIDER
// Visual separator between hero and content sections
// Matches footer divider styling for consistency
// ============================================================
.guide-hero__divider {
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.15) 20%,
    rgba(255, 255, 255, 0.15) 80%,
    transparent 100%
  );
  margin: 0 1rem;
  margin-bottom: $guide-content-spacing;
}

// ============================================================
// GUIDE CONTENT DIVIDER
// Visual separator between content sections (e.g., before FAQ)
// Matches footer divider styling for consistency
// ============================================================
.guide-content__divider {
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.15) 20%,
    rgba(255, 255, 255, 0.15) 80%,
    transparent 100%
  );
  margin: ($guide-content-spacing * 1.5) 1rem;
}

// ============================================================
// GUIDE PAGES COMPONENT
// Strict BEM structure for reusable guide/landing page layouts
// All guide pages use this component for consistent styling
// ============================================================
.guide {
  // ============================================================
  // HEADER SECTION
  // ============================================================
  &__header {
    margin-bottom: $guide-content-spacing;
  }
  &__title {
    // Big & Soft styling - responsive sizing with modern semi-bold weight
    font-size: $guide-title-size-mobile;
    font-weight: $guide-title-font-weight;
    letter-spacing: $guide-title-letter-spacing;
    color: $guide-title-color;
    
    // Desktop responsive sizing: clamp for smooth scaling between min/max
    @media (min-width: 768px) {
      font-size: clamp(#{$guide-title-size-desktop-min}, 4vw, #{$guide-title-size-desktop-max});
    }
  }
  &__subtitle {
    // Enhanced readability with muted appearance and optimal line length
    font-size: $guide-subtitle-size-mobile;
    font-weight: $guide-subtitle-font-weight;
    line-height: $guide-subtitle-line-height-mobile;
    color: $guide-subtitle-color;
    max-width: $guide-subtitle-max-width;
    
    // Desktop responsive sizing and line-height
    @media (min-width: 768px) {
      font-size: $guide-subtitle-size-desktop;
      line-height: $guide-subtitle-line-height-desktop;
    }
  }
  // ============================================================
  // CONTENT SECTIONS
  // ============================================================
  &__section {
    margin-top: $guide-section-spacing;
    
    &:first-of-type {
      margin-top: 0;
    }
  }
  &__section-title {
    // Strong second-tier hierarchy - clearly below title but prominent
    font-size: $guide-section-title-size-mobile;
    font-weight: $guide-section-title-font-weight;
    color: $guide-section-title-color;
    margin-top: $guide-section-title-margin-top;
    margin-bottom: $guide-section-title-margin-bottom;
    
    // Desktop responsive sizing
    @media (min-width: 768px) {
      font-size: $guide-section-title-size-desktop;
    }
  }
  // ============================================================
  // CONTENT LISTS
  // ============================================================
  &__steps {
    counter-reset: step;
    padding-left: 1rem;
    margin-bottom: $guide-content-spacing;
    
    > li {
      font-size: $guide-content-element-size;
      font-weight: $guide-content-element-font-weight;
      color: $guide-content-element-color;
      line-height: $guide-content-element-line-height;
      margin-bottom: 0.5rem;
    }
  }
  &__bullets {
    padding-left: 1.2rem;
    margin-bottom: $guide-content-spacing;
    
    > li {
      font-size: $guide-content-element-size;
      font-weight: $guide-content-element-font-weight;
      color: $guide-content-element-color;
      line-height: $guide-content-element-line-height;
      margin-bottom: 0.4rem;
    }
  }
  // ============================================================
  // CARD COMPONENT - FINTECH GLASSMORPHISM STYLE
  // Balanced visibility with subtle glassmorphism effect
  // ============================================================
  &__card {
    background: $guide-card-bg;
    border: $guide-card-border;
    border-radius: $guide-card-border-radius;
    padding: $guide-card-padding;
    margin-bottom: $guide-card-margin-bottom;
    box-shadow: $guide-card-shadow;
    backdrop-filter: $guide-card-backdrop-filter; // Glassmorphism blur
    -webkit-backdrop-filter: $guide-card-backdrop-filter; // Safari support
    
    // Remove top margin from first child element
    > *:first-child {
      margin-top: 0;
    }
    
    // Remove bottom margin from last child element
    > *:last-child {
      margin-bottom: 0;
    }
  }
  // ============================================================
  // CTA CARD COMPONENT - ENHANCED GLASSMORPHISM WITH BRAND ACCENT
  // Stronger visibility with pink brand color emphasis
  // ============================================================
  &__cta {
    background: $guide-cta-bg;
    border: $guide-cta-border;
    border-radius: $guide-cta-border-radius;
    padding: $guide-cta-padding;
    margin: $guide-cta-spacing 0;
    box-shadow: $guide-cta-shadow; // Pink glow for emphasis
    backdrop-filter: $guide-cta-backdrop-filter; // Glassmorphism blur
    -webkit-backdrop-filter: $guide-cta-backdrop-filter; // Safari support
    
    // Stronger overlay for extra pop
    background-blend-mode: overlay;
    position: relative;
    
    // Vignette overlay - strong darkening towards bottom to make CTA buttons pop
    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: $guide-cta-border-radius;
      background: linear-gradient(
        180deg,
        rgba(0, 0, 0, 0) 0%,
        rgba(0, 0, 0, 0.2) 30%,
        rgba(0, 0, 0, 0.5) 70%,
        rgba(0, 0, 0, 0.65) 100%
      );
      pointer-events: none; // Allow clicks to pass through
      z-index: 1;
    }
    
    // Ensure content appears above vignette
    > * {
      position: relative;
      z-index: 2;
    }
    
    &__title {
      font-size: $guide-cta-title-size-mobile !important;
      font-weight: $guide-cta-title-font-weight !important;
      color: $guide-cta-title-color;
      margin-bottom: $guide-cta-title-margin-bottom;
      
      @media (min-width: 768px) {
        font-size: $guide-cta-title-size-desktop !important;
      }
    }
    
    &__text {
      font-size: $guide-cta-text-size;
      font-weight: $guide-cta-text-font-weight;
      color: $guide-cta-text-color;
      line-height: $guide-cta-text-line-height;
      margin-bottom: $guide-cta-text-margin-bottom;
    }
  }
  // ============================================================
  // FAQ SECTION COMPONENT
  // ============================================================
  &__faq-section {
    // No top margin needed - divider handles spacing
    margin-top: 0;
  }
  &__faq {
    // Fintech card style matching Keep Learning links
    border-bottom: none;
    padding: 0; // Remove padding from card, add to summary instead
    margin-bottom: $guide-faq-spacing;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 0.75rem;
    transition: all $transition-duration ease;
    
    // Card hover effect matching Keep Learning style
    &:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(34, 211, 238, 0.3);
      transform: translateY(-2px);
      
      // When hovering card, change summary text color to cyan
      .guide__faq__summary {
        color: $accent-cyan;
        
        .h6 {
          color: $accent-cyan;
        }
        
        &::before {
          color: $accent-cyan;
        }
      }
    }
    
    &__summary {
      cursor: pointer;
      font-size: $guide-faq-question-size;
      font-weight: $guide-faq-question-font-weight;
      color: $guide-faq-question-color;
      // Use guide system transition for consistent interactions
      transition: color $transition-duration ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      // Add padding to summary so entire clickable area fills card
      padding: $guide-faq-padding;
      // Negative margin to extend clickable area to card edges
      margin: (-1px); // Compensate for border
      // Ensure summary fills width and has proper border radius
      border-radius: 0.75rem;
      width: calc(100% + 2px); // Compensate for negative margins
      // If a heading is inside the summary, animate its color too for cohesion
      .h6 {
        font-size: inherit;
        font-weight: inherit;
        color: inherit;
        transition: color $transition-duration ease;
      }
      // Remove default marker
      &::marker {
        content: "";
      }
      // Add disclosure arrow
      &::before {
        content: "▶";
        font-size: 0.75rem;
        // Use consistent guide transition duration for both transform and color
        transition: transform $transition-duration ease, color $transition-duration ease;
        flex-shrink: 0;
      }
      // Ensure links in the summary use guide system transitions
      a:not(.btn) {
        color: $text-color; // Use full white for FAQ summary links
        text-decoration: none;
        transition: color $transition-duration ease, text-decoration-color $transition-duration ease;
        
        &:hover,
        &:focus {
          color: $accent-cyan; // Use guide system accent color
          text-decoration: none;
          text-decoration-color: currentColor;
        }
        
        &:focus-visible {
          outline: 2px solid rgba($accent-cyan, 0.4);
          outline-offset: 2px;
        }
      }
      // Hover state - use refined FAQ question hover color
      &:hover {
        color: $guide-faq-question-hover-color;
        // Ensure child elements inherit the hover color
        .h6 {
          color: $guide-faq-question-hover-color;
        }
        &::before {
          color: $guide-faq-question-hover-color;
        }
      }
    }
    &__content {
      margin-top: 0;
      padding: 0 $guide-faq-padding $guide-faq-padding $guide-faq-padding; // Add padding to content (no top padding)
      font-size: $guide-content-element-size;
      font-weight: $guide-content-element-font-weight;
      color: $guide-content-element-color;
      line-height: $guide-content-element-line-height;
    }
    // Ensure FAQ links always respect the guide system transition
    &__content a:not(.btn),
    &__summary a:not(.btn) {
      transition: color $transition-duration ease, text-decoration-color $transition-duration ease;
    }
    // Open state styling - maintain hover color when expanded
    &[open] &__summary {
      color: $guide-faq-question-hover-color;
      .h6 {
        color: $guide-faq-question-hover-color;
      }
      &::before {
        transform: rotate(90deg);
        color: $guide-faq-question-hover-color;
      }
    }
    &:last-of-type {
      margin-bottom: $guide-section-spacing;
    }
  }
  // ============================================================
  // KEEP LEARNING SECTION COMPONENT
  // ============================================================
  &__next {
    // No top margin needed - divider handles spacing
    margin-top: 0;
    &__title {
      // Match section title styling for consistency
      font-size: $guide-section-title-size-mobile;
      font-weight: $guide-section-title-font-weight;
      color: $guide-section-title-color;
      margin-top: $guide-section-title-margin-top;
      margin-bottom: $guide-section-title-margin-bottom;
      
      // Desktop responsive sizing
      @media (min-width: 768px) {
        font-size: $guide-section-title-size-desktop;
      }
    }
    &__list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.75rem;
      
      // Responsive grid: 1 column on mobile, 2 on tablet+
      @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    &__link {
      font-size: $guide-content-element-size;
      font-weight: $guide-content-element-font-weight;
      color: $guide-content-element-color;
      line-height: 1.4;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: $guide-next-link-padding;
      border-radius: $guide-next-link-radius;
      background: $guide-next-link-bg;
      border: $guide-next-link-border;
      transition: all $transition-duration ease;
      
      // Add arrow after link text
      &::after {
        content: "→";
        font-size: 1.25rem;
        margin-left: 0.5rem;
        transition: transform $transition-duration ease;
        flex-shrink: 0;
      }
      
      // Hover/focus states - fintech tile effect
      &:hover,
      &:focus {
        color: $guide-next-link-hover-color;
        background: $guide-next-link-hover-bg;
        border: $guide-next-link-hover-border;
        transform: translateY(-2px);
        outline: none;
        
        &::after {
          transform: translateX(4px);
        }
      }
    }
  }
  // ============================================================
  // BACK NAVIGATION COMPONENT
  // ============================================================
  &__back-nav {
    margin-bottom: 1rem;
  }
  &__back-nav-bottom {
    margin-top: 2rem;
    margin-bottom: 2rem;
  }
  &__back-link {
    // Subtle navigation styling - smaller and more muted than content elements
    font-size: $guide-back-nav-size;
    font-weight: $guide-back-nav-font-weight;
    color: $guide-back-nav-color;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem; // Slightly more generous gap for better visual balance
    padding: 0.25rem 0.5rem; // Subtle padding for hover target
    border-radius: 0.25rem; // Small radius for hover background
    transition: color $transition-duration ease, background-color $transition-duration ease;
    
    &:hover,
    &:focus {
      color: $guide-back-nav-hover-color;
      text-decoration: none;
      outline: none;
    }
  }
  
  // ============================================================
  // UTILITY ELEMENTS
  // ============================================================
  &__divider {
    border-color: $guide-divider-color;
    opacity: 1;
    margin: 2.2rem 0;
  }
  &__disclosure {
    // Subdued fine print styling for legal/disclaimer text
    font-size: $guide-disclaimer-size;
    line-height: $guide-disclaimer-line-height;
    color: $guide-disclaimer-color;
    margin-top: 0; // No top margin needed - divider handles spacing
    margin-bottom: 0; // No space below disclosure
    font-style: italic; // Italicize for subtle emphasis
  }
  
  &__updated {
    // Last updated date styling - matches disclaimer color
    font-size: 0.813rem; // Slightly smaller than disclosure text
    color: $guide-disclaimer-color; // Same color as disclaimer (60% opacity)
    margin-top: 0.75rem;
    margin-bottom: 0;
    text-align: left;
    font-style: normal;
  }
  
  // ============================================================
  // UTILITY OVERRIDES
  // Minimal overrides for specific Bootstrap classes only
  // ============================================================
  .text-secondary.small {
    // Specific override for small secondary text in guides
    color: rgba(255, 255, 255, 0.5) !important;
  }
  hr {
    border-color: $guide-divider-color;
    opacity: 1;
  }
}

/* Guides Index */
.guide-index {
  .guide-index__groups {
    display: grid;
    gap: 1.25rem;
    grid-template-columns: 1fr;
    @media (min-width: 992px) { grid-template-columns: 1fr 1fr; }
  }
  .guide-index__group {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 0.9rem;
    padding: 1rem 1.1rem;
  }
  .guide-index__heading { 
    // Use guide section title tokens for consistency with other guide pages
    font-size: $guide-section-title-size-mobile;
    font-weight: $guide-section-title-font-weight;
    color: $guide-section-title-color;
    margin-bottom: $guide-section-title-margin-bottom;
    
    // Desktop responsive sizing
    @media (min-width: 768px) {
      font-size: $guide-section-title-size-desktop;
    }
  }
  .guide-index__list { list-style: none; margin: 0; padding: 0; }
  .guide-index__item { margin: 0.25rem 0; }
  .guide-index__link {
    display: inline-flex; 
    align-items: center; 
    gap: 0.4rem;
    font-size: $guide-content-element-size;
    font-weight: $guide-content-element-font-weight;
    color: $guide-content-element-color;
    line-height: $guide-content-element-line-height;
    text-decoration: none;
    transition: color $transition-duration ease;
    
    &:hover,
    &:focus {
      color: $accent-cyan;
      outline: none;
      
      .guide-index__label {
        text-decoration: underline;
      }
    }
  }
  
  .guide-index__label {
    text-decoration: inherit;
  }
  
  // Ensure icons don't get underlined
  .guide-index__link .text-warning { 
    text-decoration: none !important;
  }
}

// ============================================================
// SCROLL ANIMATIONS
// Light-touch fade/slide animations for guide pages
// Applied via IntersectionObserver in guideAnimations.js
// ============================================================

// Keyframes for fade-in animation
@keyframes guide-fade-in {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Keyframes for fade-in from left
@keyframes guide-fade-in-left {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

// Base state for elements that will animate
.animation-ready {
  opacity: 0;
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  
  // Prevent layout shift by reserving space
  will-change: opacity, transform;
  
  // Visible state (used when bypassing animations)
  &.animation-visible {
    opacity: 1;
  }
}

// Disable animations ONLY for guide__section elements that contain guide__card
// This uses :has() selector to check if the section contains a .guide__card
// Keep animations for sections with CTA, FAQ, and other content
.guide__section.animation-ready:has(.guide__card) {
  opacity: 1;
  transform: none;
  transition: none;
}

// Active state when element enters viewport
.animation-active {
  opacity: 1;
  animation-duration: 0.6s;
  animation-timing-function: ease-out;
  animation-fill-mode: both;
  
  &.fade-in {
    animation-name: guide-fade-in;
  }
  
  &.fade-in-left {
    animation-name: guide-fade-in-left;
  }
}

// Disable animations ONLY for guide__section elements that contain guide__card
.guide__section.animation-active:has(.guide__card) {
  animation: none;
}

// Reduce motion for accessibility
@media (prefers-reduced-motion: reduce) {
  .animation-ready {
    opacity: 1;
    transform: none;
    transition: none;
  }
  
  .animation-active {
    animation: none;
  }
  
  // Disable hero gradient and floating animations
  .hero--guide {
    animation: none !important;
    
    &::before,
    &::after {
      animation: none !important;
      opacity: 0.2;
    }
  }
}

// ============================================================
// HERO GUIDE ANIMATIONS
// Subtle gradient shift and floating accent shapes
// ============================================================

// Gradient background animation (slow, subtle shift)
@keyframes guide-hero-gradient {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

// Floating accent shapes (slow up/down movement)
@keyframes guide-hero-float {
  0%, 100% {
    transform: translateY(0) scale(1);
  }
  50% {
    transform: translateY(-30px) scale(1.05);
  }
}